<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Web - Warner&#039;s Wiki</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Warner&#039;s Wiki"><meta name="msapplication-TileImage" content="/logo.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Warner&#039;s Wiki"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="一、Apache1.1 Apache介绍Apache HTTP Server（简称Apache）是Apache软件基金会的一个开放源码的网页服务器，是世界使用排名第一的Web服务器软件。它可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是最流行的Web服务器端软件之一。它快速、可靠并且可通过简单的API扩充，将Perl&amp;#x2F;Python等解释器编译到服务器中。 Ap"><meta property="og:type" content="blog"><meta property="og:title" content="Web"><meta property="og:url" content="https://warnerchen.github.io/2024/02/18/web/"><meta property="og:site_name" content="Warner&#039;s Wiki"><meta property="og:description" content="一、Apache1.1 Apache介绍Apache HTTP Server（简称Apache）是Apache软件基金会的一个开放源码的网页服务器，是世界使用排名第一的Web服务器软件。它可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是最流行的Web服务器端软件之一。它快速、可靠并且可通过简单的API扩充，将Perl&amp;#x2F;Python等解释器编译到服务器中。 Ap"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://warnerchen.github.io/2024/02/18/web/%E5%9F%BA%E4%BA%8EIP%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png"><meta property="og:image" content="https://warnerchen.github.io/2024/02/18/web/%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png"><meta property="og:image" content="https://warnerchen.github.io/2024/02/18/web/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%90%8D%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png"><meta property="og:image" content="https://warnerchen.github.io/2024/02/18/web/php%E4%BB%A5%E6%A8%A1%E5%9D%97%E8%BF%90%E8%A1%8C.png"><meta property="og:image" content="https://warnerchen.github.io/2024/02/18/web/%E6%AD%A3%E5%B8%B8%E4%B8%8A%E7%BD%91%E6%B5%81%E7%A8%8B.png"><meta property="og:image" content="https://warnerchen.github.io/2024/02/18/web/%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%BD%91%E6%B5%81%E7%A8%8B.png"><meta property="article:published_time" content="2024-02-18T08:06:41.000Z"><meta property="article:modified_time" content="2025-02-26T23:37:00.000Z"><meta property="article:author" content="Warner Chen"><meta property="article:tag" content="web"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://warnerchen.github.io/2024/02/18/web/%E5%9F%BA%E4%BA%8EIP%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://warnerchen.github.io/2024/02/18/web/"},"headline":"Web","image":["https://warnerchen.github.io/2024/02/18/web/%E5%9F%BA%E4%BA%8EIP%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png","https://warnerchen.github.io/2024/02/18/web/%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png","https://warnerchen.github.io/2024/02/18/web/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%90%8D%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png","https://warnerchen.github.io/2024/02/18/web/php%E4%BB%A5%E6%A8%A1%E5%9D%97%E8%BF%90%E8%A1%8C.png","https://warnerchen.github.io/2024/02/18/web/%E6%AD%A3%E5%B8%B8%E4%B8%8A%E7%BD%91%E6%B5%81%E7%A8%8B.png","https://warnerchen.github.io/2024/02/18/web/%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%BD%91%E6%B5%81%E7%A8%8B.png"],"datePublished":"2024-02-18T08:06:41.000Z","dateModified":"2025-02-26T23:37:00.000Z","author":{"@type":"Person","name":"Warner Chen"},"publisher":{"@type":"Organization","name":"Warner's Wiki","logo":{"@type":"ImageObject","url":"https://warnerchen.github.io/logo.jpg"}},"description":"一、Apache1.1 Apache介绍Apache HTTP Server（简称Apache）是Apache软件基金会的一个开放源码的网页服务器，是世界使用排名第一的Web服务器软件。它可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是最流行的Web服务器端软件之一。它快速、可靠并且可通过简单的API扩充，将Perl&#x2F;Python等解释器编译到服务器中。 Ap"}</script><link rel="canonical" href="https://warnerchen.github.io/2024/02/18/web/"><link rel="icon" href="/logo.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/logo.jpg" alt="Warner&#039;s Wiki" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/warnerchen/"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-02-18T08:06:41.000Z" title="2/18/2024, 4:06:41 PM">2024-02-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-02-26T23:37:00.000Z" title="2/27/2025, 7:37:00 AM">2025-02-27</time></span><span class="level-item">an hour read (About 10193 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Web</h1><div class="content"><h2 id="一、Apache"><a href="#一、Apache" class="headerlink" title="一、Apache"></a>一、Apache</h2><h3 id="1-1-Apache介绍"><a href="#1-1-Apache介绍" class="headerlink" title="1.1 Apache介绍"></a>1.1 Apache介绍</h3><p>Apache HTTP Server（简称Apache）是Apache软件基金会的一个开放源码的网页服务器，是世界使用排名第一的Web服务器软件。它可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是最流行的Web服务器端软件之一。它快速、可靠并且可通过简单的API扩充，将Perl&#x2F;Python等解释器编译到服务器中。</p>
<p>Apache HTTP服务器是一个模块化的服务器，源于NCSAhttpd服务器，经过多次修改，成为世界使用排名第一的Web服务器软件。</p>
<p>Apache官方文档：<a href="http://httpd.apache.org/docs/">http://httpd.apache.org/docs/</a></p>
<span id="more"></span>

<h3 id="1-2-通过脚本源码安装Apache"><a href="#1-2-通过脚本源码安装Apache" class="headerlink" title="1.2 通过脚本源码安装Apache"></a>1.2 通过脚本源码安装Apache</h3><ol>
<li>编写安装脚本</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin -r www</span><br><span class="line">vim apache-install.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">apr_version=1.7.0</span><br><span class="line">apr_iconv_version=1.2.2</span><br><span class="line">apr_util_version=1.6.1</span><br><span class="line">apache_version=2.4.46</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检查</span></span><br><span class="line">function check()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">检查是否为root用户</span></span><br><span class="line">   if [ $USER != &#x27;root&#x27; ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;\e[1;31m error:need to be root so that \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">   </span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">检查是否安装了wget</span></span><br><span class="line">   if [ `rpm -qa | grep wget | wc -l` -lt 1 ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;\e[1;31m error:not found wget \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装前准备</span></span><br><span class="line">function install_pre()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">安装依赖</span></span><br><span class="line">   if [ ! `yum -y install zlib-devel pcre-devel libxml2 expat-devel &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;\e[1;31m error:yum install dependency package failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">下载apr</span></span><br><span class="line">   cd /usr/local</span><br><span class="line">   if [ ! `wget https://downloads.apache.org/apr/apr-$&#123;apr_version&#125;.tar.bz2 &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       tar -xf apr-$&#123;apr_version&#125;.tar.bz2</span><br><span class="line">       if [ ! -d apr-$&#123;apr_version&#125; ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;31m error:not found apr-$&#123;apr_version&#125; \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       else</span><br><span class="line">           cd apr-$&#123;apr_version&#125;</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:Failed to download apr-$&#123;apr_version&#125;.tar.bz2 \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">安装apr</span></span><br><span class="line">   echo &quot;apr configure...&quot;</span><br><span class="line">   ./configure --prefix=/usr/local/apr &amp;&gt; /dev/null</span><br><span class="line">   if [ `echo $?` -eq 0 ]</span><br><span class="line">   then</span><br><span class="line">       echo &quot;apr make &amp;&amp; make install...&quot;</span><br><span class="line">       make &amp;&amp; make install &amp;&gt; /dev/null</span><br><span class="line">       if [ `echo $?` -eq 0 ]</span><br><span class="line">       then</span><br><span class="line">	   echo -e &quot;\e[1;32m apr installed successfully \e[0m&quot;</span><br><span class="line">       else</span><br><span class="line">	   echo -e &quot;\e[1;31m apr installed failed \e[0m&quot;</span><br><span class="line">	   exit 1</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:apr configure failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">下载apr-iconv</span></span><br><span class="line">   cd /usr/local</span><br><span class="line">   if [ ! `wget https://www.apache.org/dist/apr/apr-iconv-$&#123;apr_iconv_version&#125;.tar.bz2 &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       tar -xf apr-iconv-$&#123;apr_iconv_version&#125;.tar.bz2</span><br><span class="line">       if [ ! -d apr-iconv-$&#123;apr_iconv_version&#125; ]</span><br><span class="line">       then </span><br><span class="line">           echo -e &quot;\e[1;31m error:not found apr-iconv-$&#123;apr_iconv_version&#125; \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       else</span><br><span class="line">           cd apr-iconv-$&#123;apr_iconv_version&#125;</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:Failed to download apr-iconv-$&#123;apr_iconv_version&#125;.tar.bz2 \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">安装apr-iconv</span></span><br><span class="line">   echo &quot;apr-iconv configure...&quot;</span><br><span class="line">   ./configure --prefix=/usr/local/apr-iconv --with-apr=/usr/local/apr &amp;&gt; /dev/null</span><br><span class="line">   if [ `echo $?` -eq 0 ]</span><br><span class="line">   then </span><br><span class="line">       echo &quot;apr-iconv make &amp;&amp; make install...&quot;</span><br><span class="line">       make &amp;&amp; make install &amp;&gt; /dev/null</span><br><span class="line">       if [ `echo $?` -eq 0 ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;32m apr-iconv installed successfully \e[0m&quot;</span><br><span class="line">       else</span><br><span class="line">           echo -e &quot;\e[1;31m apr-iconv installed failed \e[0m&quot;</span><br><span class="line">	   exit 1</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:apr-iconv configure failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">下载apr-util</span></span><br><span class="line">   cd /usr/local</span><br><span class="line">   if [ ! `wget https://www.apache.org/dist/apr/apr-util-$&#123;apr_util_version&#125;.tar.bz2 &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       tar -xf apr-util-$&#123;apr_util_version&#125;.tar.bz2</span><br><span class="line">       if [ ! -d apr-util-$&#123;apr_util_version&#125; ]</span><br><span class="line">       then </span><br><span class="line">           echo -e &quot;\e[1;31m error:not found apr-util-$&#123;apr_util_version&#125; \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       else</span><br><span class="line">           cd apr-util-$&#123;apr_util_version&#125;</span><br><span class="line">       fi  </span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:Failed to download apr-util-$&#123;apr_util_version&#125;.tar.bz2 \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">安装apr-util</span></span><br><span class="line">   echo &quot;apr-util configure...&quot;</span><br><span class="line">   ./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr/ &amp;&gt; /dev/null</span><br><span class="line">   if [ `echo $?` -eq 0 ]</span><br><span class="line">   then</span><br><span class="line">       echo &quot;apr-util make &amp;&amp; make install...&quot;</span><br><span class="line">       make &amp;&amp; make install &amp;&gt; /dev/null</span><br><span class="line">       if [ `echo $?` -eq 0 ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;32m apr-util installed successfully \e[0m&quot;</span><br><span class="line">       else</span><br><span class="line">           echo -e &quot;\e[1;31m apr-util installed failed \e[0m&quot;</span><br><span class="line">	   exit 1</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:apr-util configure failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载安装Apache</span></span><br><span class="line">function apache_install()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">下载Apache</span></span><br><span class="line">   cd /usr/local</span><br><span class="line">   if [ ! `wget https://downloads.apache.org/httpd/httpd-$&#123;apache_version&#125;.tar.gz &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       tar -xf httpd-$&#123;apache_version&#125;.tar.gz</span><br><span class="line">       if [ ! -d httpd-$&#123;apache_version&#125; ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;31m error:not found httpd-$&#123;apache_version&#125; \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       else</span><br><span class="line">           cd httpd-$&#123;apache_version&#125;</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:Failed to download httpd-$&#123;apache_version&#125; \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">安装Apache</span></span><br><span class="line">   echo &quot;Apache configure...&quot;</span><br><span class="line">   ./configure --prefix=/usr/local/apache --enable-mpms-shared=all --with-mpm=event --with-apr=/usr/local/apr --with-apr-util=/usr/local/apr-util --enable-so --enable-remoteip --enable-proxy --enable-proxy-fcgi --enable-proxy-uwsgi --enable-deflate=shared --enable-expires=shared --enable-rewrite=shared --enable-cache --enable-file-cache --enable-mem-cache --enable-disk-cache --enable-static-support --enable-static-ab --disable-userdir --enable-nonportable-atomics --disable-ipv6 --with-sendfile &amp;&gt; /dev/null</span><br><span class="line">   if [ `echo $?` -eq 0 ]</span><br><span class="line">   then</span><br><span class="line">       echo &quot;Apache make &amp;&amp; make install...&quot;</span><br><span class="line">       make &amp;&amp; make install &amp;&gt; /dev/null</span><br><span class="line">       if [ `echo $?` -eq 0 ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;32m Apache installed sucessfully \e[0m&quot;</span><br><span class="line">       else</span><br><span class="line">           echo -e &quot;\e[1;31m Apache installed failed \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m Apache configure failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check</span><br><span class="line">install_pre</span><br><span class="line">apache_install</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写启动脚本</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">apache_doc=/usr/local/apache/bin</span><br><span class="line">apache_pid=/usr/local/apache/logs/httpd.pid</span><br><span class="line"></span><br><span class="line">function apache_start()</span><br><span class="line">&#123;</span><br><span class="line">   apache_num=`ps -ef | grep httpd | wc -l`</span><br><span class="line">   if [ $apache_num -gt 1 ] &amp;&amp; [ -f $apache_pid ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;Apache [\e[1;32m running \e[0m]&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   elif [ $apache_num -eq 1 ] &amp;&amp; [ -f $apache_pid ]</span><br><span class="line">   then</span><br><span class="line">       killall httpd</span><br><span class="line">   fi</span><br><span class="line">   cd /usr/local/apache/bin;./apachectl</span><br><span class="line">   echo -e &quot;start Apache [\e[1;32m OK \e[0m]&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function apache_stop()</span><br><span class="line">&#123;</span><br><span class="line">   apache_num=`ps -ef | grep httpd | wc -l`</span><br><span class="line">   if [ $apache_num -eq 1 ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;Apache [\e[1;31m stopping \e[0m]&quot;</span><br><span class="line">   else</span><br><span class="line">       killall httpd</span><br><span class="line">       echo -e &quot;stop Apache [\e[1;32m OK \e[0m]&quot;</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function apache_restart()</span><br><span class="line">&#123;</span><br><span class="line">   cd /usr/local/apache/bin;./apachectl restart</span><br><span class="line">   echo -e &quot;restart Apache [\e[1;32m OK \e[0m]&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function apache_status()</span><br><span class="line">&#123;</span><br><span class="line">   apache_num=`ps -ef | grep httpd | wc -l`</span><br><span class="line">   if [ $apache_num -gt 1 ] &amp;&amp; [ -f $nginx_pid ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;Apache [\e[1;32m running \e[0m]&quot;</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;Apache [\e[1;31m stopping \e[0m]&quot;</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function apache_reload()</span><br><span class="line">&#123;</span><br><span class="line">   apache_num=`ps -ef | grep httpd | wc -l`</span><br><span class="line">   if [ $apache_num -gt 1 ] &amp;&amp; [ -f $nginx_pid ]</span><br><span class="line">   then</span><br><span class="line">       cd /usr/local/apache/bin;./apachectl graceful</span><br><span class="line">       echo -e &quot;reload Apache [\e[1;32m OK \e[0m]&quot;</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;Apache [\e[1;31m stopping \e[0m]&quot;</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">start)</span><br><span class="line">        apache_start</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">        apache_stop</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">restart)</span><br><span class="line">        apache_restart</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">status)</span><br><span class="line">        apache_status</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">reload)</span><br><span class="line">        apache_reload</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="1-3-多处理模块MPM"><a href="#1-3-多处理模块MPM" class="headerlink" title="1.3 多处理模块MPM"></a>1.3 多处理模块MPM</h3><p>Apache HTTP 服务器被设计为一个功能强大，并且灵活的 web 服务器， 可以在很多平台与环境中工作。不同平台和不同的环境往往需要不同 的特性，或可能以不同的方式实现相同的特性最有效率。Apache 通过模块化的设计来适应各种环境。这种设计允许网站管理员通过在 编译时或运行时，选择哪些模块将会加载在服务器中，来选择服务器特性。</p>
<p>实际上就是用来<strong>接受请求</strong>和<strong>处理请求</strong>的。</p>
<p>Apache的三种工作方式：</p>
<ol>
<li>Prefork MPM：使用多个进程，每个进程只有一个线程，每个进程再某个确定的时间只能维持一个连接，有点是稳定，缺点是内存消耗过高。</li>
</ol>
<p>![Prefork MPM](Prefork MPM.png)</p>
<ol>
<li>Worker MPM：使用多个进程，每个进程有多个线程，每个线程在某个确定的时间只能维持一个连接，内存占用比较小，是个大并发、高流量的场景，缺点是一个线程崩溃，整个进程就会连同其任何线程一起挂掉。</li>
</ol>
<p>![Worker MPM](Worker MPM.png)</p>
<ol start="3">
<li>Event MPM：使用多进程多线程+epoll的模式。</li>
</ol>
<p>![Event MPM](Event MPM.png)</p>
<h3 id="1-4-虚拟主机"><a href="#1-4-虚拟主机" class="headerlink" title="1.4 虚拟主机"></a>1.4 虚拟主机</h3><p>默认情况下，一个web服务器只能发布一个默认网站，也就是只能发布一个web站点，对于大网站来说还好，但对于访问量较少的小网站那就显得有点浪费了。</p>
<p>而虚拟主机就可以实现在一个web服务器上发布多个站点，分为基于IP地址、域名和端口三种。</p>
<p>Apache的虚拟主机和默认网站不能够同时存在，如果设置了虚拟主机那么默认网站也就失效了，需要在用虚拟主机发布默认站点才可解决。</p>
<p>基于IP：基于IP的虚拟主机需要耗费大量的IP地址，只适合IP地址充足的环境。</p>
<p>基于端口：需要耗费较多的端口，适合私网环境。</p>
<p>基于域名：需要耗费较多的域名，适合公网环境。</p>
<h4 id="1-4-1-基于IP的虚拟主机"><a href="#1-4-1-基于IP的虚拟主机" class="headerlink" title="1.4.1 基于IP的虚拟主机"></a>1.4.1 基于IP的虚拟主机</h4><ol>
<li>在主配文件中调用虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/httpd.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Virtual hosts</span></span><br><span class="line">Include conf/extra/httpd-vhosts.conf</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加一个逻辑网卡，重启即失效</span></span><br><span class="line">ifconfig eth0:1 192.168.88.100/24 up</span><br><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost 49.232.160.75:80&gt;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">管理员邮箱</span></span><br><span class="line">    # ServerAdmin webmaster@dummy-host.example.com</span><br><span class="line">    # web目录</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web1&quot;</span><br><span class="line">    # 域名</span><br><span class="line">    # ServerName dummy-host.example.com</span><br><span class="line">    # 给域名起别名，起到重定向作用</span><br><span class="line">    # ServerAlias www.dummy-host.example.com</span><br><span class="line">    # 错误日子</span><br><span class="line">    # ErrorLog &quot;logs/dummy-host.example.com-error_log&quot;</span><br><span class="line">    # 访问日志</span><br><span class="line">    # CustomLog &quot;logs/dummy-host.example.com-access_log&quot; common</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost 192.168.88.100:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web2&quot;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建站点目录和文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/apache/htdocs/web&#123;1..2&#125;</span><br><span class="line">echo &#x27;this is web1&#x27; &gt; /usr/local/apache/htdocs/web1/index.html</span><br><span class="line">echo &#x27;this is web2&#x27; &gt; /usr/local/apache/htdocs/web2/index.html</span><br><span class="line">./apache start</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>测试</li>
</ol>
<p><img src="/2024/02/18/web/%E5%9F%BA%E4%BA%8EIP%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png" alt="基于IP虚拟主机测试"></p>
<h4 id="1-4-2-基于端口的虚拟主机"><a href="#1-4-2-基于端口的虚拟主机" class="headerlink" title="1.4.2 基于端口的虚拟主机"></a>1.4.2 基于端口的虚拟主机</h4><ol>
<li>修改虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web1&quot;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">Listen 81</span><br><span class="line">&lt;VirtualHost *:81&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web2&quot;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>测试</li>
</ol>
<p><img src="/2024/02/18/web/%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png" alt="基于端口虚拟主机测试"></p>
<h4 id="1-4-3-基于域名的虚拟主机"><a href="#1-4-3-基于域名的虚拟主机" class="headerlink" title="1.4.3 基于域名的虚拟主机"></a>1.4.3 基于域名的虚拟主机</h4><ol>
<li>修改虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web1&quot;</span><br><span class="line">    ServerName www.cqm1.com</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web2&quot;</span><br><span class="line">    ServerName www.cqm2.com</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>测试</li>
</ol>
<p><img src="/2024/02/18/web/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%90%8D%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%B5%8B%E8%AF%95.png" alt="基于域名虚拟主机测试"></p>
<h3 id="1-5-LAMP"><a href="#1-5-LAMP" class="headerlink" title="1.5 LAMP"></a>1.5 LAMP</h3><p>LAMP：Linux + Apache + Mysql + PHP</p>
<p>作用就是构建一个PHP业务环境，用来发布PHP网站。</p>
<h4 id="1-5-1-Mysql通过脚本源码安装"><a href="#1-5-1-Mysql通过脚本源码安装" class="headerlink" title="1.5.1 Mysql通过脚本源码安装"></a>1.5.1 Mysql通过脚本源码安装</h4><ol>
<li>编写安装脚本</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">mysql_version=5.7.35</span><br><span class="line">install_dir=/opt</span><br><span class="line">data_dir=/data</span><br><span class="line">wget_url=&quot;https://mirrors.tuna.tsinghua.edu.cn/mysql/downloads/MySQL-5.7/mysql-$&#123;mysql_version&#125;-linux-glibc2.12-x86_64.tar.gz&quot;</span><br><span class="line"></span><br><span class="line">function loginfo()&#123;</span><br><span class="line">    if [[ $? -eq 0 ]];then</span><br><span class="line">        echo -e &quot;\033[32m[INFO][$(date +&quot;%F %T&quot;)] $1 succeed! \033[0m&quot;</span><br><span class="line">    else</span><br><span class="line">        echo -e &quot;\033[31m[ERROR][$(date +&quot;%F %T&quot;)] $1 failed! \033[0m&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mysql_install()&#123;</span><br><span class="line">    echo -e &quot;\033[32mBegin install mysql V$&#123;mysql_version&#125; ...\033[0m&quot;</span><br><span class="line">    </span><br><span class="line">    # 安装依赖</span><br><span class="line">    sudo yum -y install libaio &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">    loginfo &quot;libaio install&quot;</span><br><span class="line"></span><br><span class="line">    # 下载mysql</span><br><span class="line">    echo -e &quot;\033[32mBegin download mysql V$&#123;mysql_version&#125; ...\033[0m&quot;</span><br><span class="line">    curl -O $wget_url &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">    mv ./mysql-$&#123;mysql_version&#125;-linux-glibc2.12-x86_64.tar.gz $install_dir</span><br><span class="line">    loginfo &quot;mysql software download&quot;</span><br><span class="line"></span><br><span class="line">    # 解压缩mysql</span><br><span class="line">    sudo tar -xf $install_dir/mysql-$&#123;mysql_version&#125;-linux-glibc2.12-x86_64.tar.gz -C $install_dir</span><br><span class="line">    loginfo &quot;mysql software decompression&quot;</span><br><span class="line"></span><br><span class="line">    # 创建配置文件目录和数据目录</span><br><span class="line">    if [[ -d $install_dir/mysql ]];then</span><br><span class="line">        rm -rf $install_dir/mysql</span><br><span class="line">    fi</span><br><span class="line">    sudo ln -s $install_dir/mysql-$&#123;mysql_version&#125;-linux-glibc2.12-x86_64 $install_dir/mysql</span><br><span class="line">    loginfo &quot;create mysql config dir soft link&quot;</span><br><span class="line">    if [[ -d $data_dir/mysql ]];then</span><br><span class="line">        rm -rf $data_dir/mysql</span><br><span class="line">    fi</span><br><span class="line">    sudo mkdir -p $data_dir/mysql</span><br><span class="line">    loginfo &quot;create mysql data dir&quot;</span><br><span class="line"></span><br><span class="line">    # 修改启动脚本</span><br><span class="line">    sudo sed -i &quot;46s#basedir=#basedir=$&#123;install_dir&#125;/mysql#&quot; $&#123;install_dir&#125;/mysql/support-files/mysql.server</span><br><span class="line">    sudo sed -i &quot;47s#datadir=#datadir=$&#123;data_dir&#125;/mysql#&quot; $&#123;install_dir&#125;/mysql/support-files/mysql.server</span><br><span class="line">    sudo cp $&#123;install_dir&#125;/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">    sudo chmod 755 /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">    # 创建用户组及用户</span><br><span class="line">    if ! grep -q &#x27;^mysql:&#x27; /etc/group</span><br><span class="line">    then</span><br><span class="line">        sudo groupadd mysql</span><br><span class="line">        loginfo &quot;create user mysql&quot;</span><br><span class="line">    fi</span><br><span class="line">    if ! grep -q &#x27;^mysql:&#x27; /etc/passwd</span><br><span class="line">    then</span><br><span class="line">        sudo useradd -r -g mysql -s /bin/false mysql</span><br><span class="line">        loginfo &quot;create group mysql&quot;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # 授权</span><br><span class="line">    sudo chown -R mysql:mysql $install_dir/mysql</span><br><span class="line">    sudo chown -R mysql:mysql $data_dir/mysql</span><br><span class="line"></span><br><span class="line">    # 为二进制文件创建软连接</span><br><span class="line">    if [ ! -f /usr/bin/mysql ]</span><br><span class="line">    then</span><br><span class="line">        sudo ln -s /opt/mysql/bin/mysql /usr/bin/</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # 创建配置文件</span><br><span class="line">    if [ -f /etc/my.cnf ]</span><br><span class="line">    then</span><br><span class="line">        sudo rm -f /etc/my.cnf</span><br><span class="line">    fi</span><br><span class="line">    sudo bash -c &quot;cat &gt;&gt; /etc/my.cnf&quot; &lt;&lt;EOF</span><br><span class="line">[mysqld]</span><br><span class="line">datadir                             = /data/mysql</span><br><span class="line">basedir                             = /opt/mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">tmpdir                              = /data/mysql/tmp_mysql</span></span><br><span class="line">port                                = 3306</span><br><span class="line">socket                              = /data/mysql/mysql.sock</span><br><span class="line">pid-file                            = /data/mysql/mysql.pid</span><br><span class="line">max_connections                     = 8000</span><br><span class="line">max_connect_errors                  = 100000</span><br><span class="line">max_user_connections                = 3000</span><br><span class="line">check_proxy_users                   = on</span><br><span class="line">mysql_native_password_proxy_users   = on</span><br><span class="line">local_infile                        = OFF</span><br><span class="line">symbolic-links                      = FALSE</span><br><span class="line">group_concat_max_len                = 4294967295</span><br><span class="line">max_join_size                       = 18446744073709551615</span><br><span class="line">max_execution_time                  = 20000</span><br><span class="line">lock_wait_timeout                   = 60</span><br><span class="line">autocommit                          = 1</span><br><span class="line">lower_case_table_names              = 1</span><br><span class="line">thread_cache_size                   = 64</span><br><span class="line">disabled_storage_engines            = &quot;MyISAM,FEDERATED&quot;</span><br><span class="line">character_set_server                = utf8mb4</span><br><span class="line">character-set-client-handshake      = FALSE</span><br><span class="line">collation_server                    = utf8mb4_general_ci</span><br><span class="line">init_connect                        = &#x27;SET NAMES utf8mb4&#x27;</span><br><span class="line">transaction-isolation               = &quot;READ-COMMITTED&quot;</span><br><span class="line">skip_name_resolve                   = ON</span><br><span class="line">explicit_defaults_for_timestamp     = ON</span><br><span class="line">log_timestamps                      = SYSTEM</span><br><span class="line">local_infile                        = OFF</span><br><span class="line">event_scheduler                     = OFF</span><br><span class="line">query_cache_type                    = OFF</span><br><span class="line">query_cache_size                    = 0</span><br><span class="line">sql_mode                            = NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO</span><br><span class="line">log_error                           = /data/mysql/mysql.err</span><br><span class="line">slow_query_log                      = ON</span><br><span class="line">slow_query_log_file                 = /data/mysql/slow.log</span><br><span class="line">long_query_time                     = 1</span><br><span class="line">general_log                         = OFF</span><br><span class="line">general_log_file                    = /data/mysql/general.log</span><br><span class="line">expire_logs_days                    = 99</span><br><span class="line">log-bin                             = /data/mysql/mysql-bin</span><br><span class="line">log-bin-index                       = /data/mysql/mysql-bin.index</span><br><span class="line">max_binlog_size                     = 500M</span><br><span class="line">binlog_format                       = mixed</span><br><span class="line">binlog_rows_query_log_events        = ON</span><br><span class="line">binlog_cache_size                   = 128k</span><br><span class="line">binlog_stmt_cache_size              = 128k</span><br><span class="line">log-bin-trust-function-creators     = 1</span><br><span class="line">max_binlog_cache_size               = 2G</span><br><span class="line">max_binlog_stmt_cache_size          = 2G</span><br><span class="line">relay_log                           = /data/mysql/relay</span><br><span class="line">relay_log_index                     = /data/mysql/relay.index</span><br><span class="line">max_relay_log_size                  = 500M</span><br><span class="line">relay_log_purge                     = ON</span><br><span class="line">relay_log_recovery                  = ON</span><br><span class="line">server_id                           = 1</span><br><span class="line">read_buffer_size                    = 1M</span><br><span class="line">read_rnd_buffer_size                = 2M</span><br><span class="line">sort_buffer_size                    = 64M</span><br><span class="line">join_buffer_size                    = 64M</span><br><span class="line">tmp_table_size                      = 64M</span><br><span class="line">max_allowed_packet                  = 128M</span><br><span class="line">max_heap_table_size                 = 64M</span><br><span class="line">connect_timeout                     = 43200</span><br><span class="line">wait_timeout                        = 43200</span><br><span class="line">back_log                            = 512</span><br><span class="line">interactive_timeout                 = 300</span><br><span class="line">net_read_timeout                    = 30</span><br><span class="line">net_write_timeout                   = 30</span><br><span class="line">skip_external_locking               = ON</span><br><span class="line">key_buffer_size                     = 16M</span><br><span class="line">bulk_insert_buffer_size             = 16M</span><br><span class="line">concurrent_insert                   = ALWAYS</span><br><span class="line">open_files_limit                    = 65000</span><br><span class="line">table_open_cache                    = 16000</span><br><span class="line">table_definition_cache              = 16000</span><br><span class="line">default_storage_engine              = InnoDB</span><br><span class="line">default_tmp_storage_engine          = InnoDB</span><br><span class="line">internal_tmp_disk_storage_engine    = InnoDB</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">socket                              = /data/mysql/mysql.sock</span><br><span class="line">default_character_set               = utf8mb4</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default_character_set               = utf8mb4</span><br><span class="line"></span><br><span class="line">[ndatad default]</span><br><span class="line">TransactionDeadLockDetectionTimeOut = 20000</span><br><span class="line">EOF</span><br><span class="line">    sudo chown -R mysql:mysql /etc/my.cnf</span><br><span class="line">    loginfo &quot;configure my.cnf&quot;</span><br><span class="line"></span><br><span class="line">    # 创建SSL证书</span><br><span class="line">    # sudo mkdir -p $&#123;install_dir&#125;/mysql/ca-pem/</span><br><span class="line">    # sudo $&#123;install_dir&#125;/mysql/bin/mysql_ssl_rsa_setup -d $&#123;install_dir&#125;/mysql/ca-pem/ --uid=mysql</span><br><span class="line">    # sudo chown -R mysql:mysql $&#123;install_dir&#125;/mysql/ca-pem/</span><br><span class="line"></span><br><span class="line">    # sudo bash -c &quot;cat &gt;&gt; $&#123;data_dir&#125;/mysql/init_file.sql&quot; &lt;&lt;EOF</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> global sql_safe_updates=0;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> global sql_select_limit=50000;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">EOF</span></span><br><span class="line">    # sudo chown -R mysql:mysql $&#123;data_dir&#125;/mysql/init_file.sql</span><br><span class="line">    # sudo chown -R mysql:mysql /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">    # 初始化</span><br><span class="line">    $&#123;install_dir&#125;/mysql/bin/mysqld --initialize --user=mysql --basedir=$&#123;DEPLOY_PATH&#125;/mysql --datadir=/data/mysql </span><br><span class="line">    loginfo &quot;initialize mysql&quot;</span><br><span class="line"></span><br><span class="line">    # 客户端环境变量</span><br><span class="line">    echo &quot;export PATH=\$PATH:$&#123;install_dir&#125;/mysql/bin&quot; | sudo tee /etc/profile.d/mysql.sh</span><br><span class="line">    source /etc/profile.d/mysql.sh</span><br><span class="line">    loginfo &quot;configure envirement&quot;</span><br><span class="line"></span><br><span class="line">    # 获取初始密码</span><br><span class="line">    mysql_init_passwd=$(grep &#x27;A temporary password is generated&#x27; $&#123;data_dir&#125;/mysql/mysql.err | awk &#x27;&#123;print $NF&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">    # 启动服务</span><br><span class="line">    chkconfig --add mysqld</span><br><span class="line">    sudo systemctl start mysqld</span><br><span class="line">    loginfo &quot;start mysqld&quot;</span><br><span class="line"></span><br><span class="line">    # 修改密码</span><br><span class="line">    mysql --connect-expired-password -uroot -p$&#123;mysql_init_passwd&#125; -e &#x27;alter user user() identified by &quot;toortoor&quot;;&#x27; &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">    loginfo &quot;edit mysql root password&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mysql_install</span><br></pre></td></tr></table></figure>

<h4 id="1-5-2-PHP通过脚本源码安装"><a href="#1-5-2-PHP通过脚本源码安装" class="headerlink" title="1.5.2 PHP通过脚本源码安装"></a>1.5.2 PHP通过脚本源码安装</h4><ol>
<li>编写安装脚本</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cmake_version=3.22.0</span><br><span class="line">libzip_version=1.8.0</span><br><span class="line">php_version=7.4.16</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检查</span></span><br><span class="line">function check()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">检查是否为root用户</span></span><br><span class="line">   if [ $USER != &quot;root&quot; ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;\e[1;31m error:need to be root so that \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">检查是否安装了wget</span></span><br><span class="line">   if [ `rpm -qa | grep wget | wc -l` -lt 1 ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;\e[1;31m error:not found wget \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装前准备</span></span><br><span class="line">function pre()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">安装依赖包</span></span><br><span class="line">   if [ ! `yum -y install gcc-c++ libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel gd net-snmp-* sqlite-devel oniguruma-devel &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;\e[1;31m error:yum install dependency package failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">下载最新版cmake</span></span><br><span class="line">   cd /usr/local</span><br><span class="line">   if [ ! `wget https://github.com/Kitware/CMake/releases/download/v$&#123;cmake_version&#125;/cmake-$&#123;cmake_version&#125;.tar.gz &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">      tar -xf cmake-$&#123;cmake_version&#125;.tar.gz</span><br><span class="line">      if [ ! -d cmake-$&#123;cmake_version&#125; ]</span><br><span class="line">      then</span><br><span class="line">         echo -e &quot;\e[1;31m error:no found cmake-$&#123;cmake_version&#125;  \e[0m&quot;</span><br><span class="line">         exit 1</span><br><span class="line">      else</span><br><span class="line">         cd cmake-$&#123;cmake_version&#125;</span><br><span class="line">      fi</span><br><span class="line">   else</span><br><span class="line">      echo -e &quot;\e[1;31m error:Failed to download cmake-$&#123;cmake_version&#125; \e[0m&quot;</span><br><span class="line">      exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">安装cmake</span></span><br><span class="line">   echo &quot;cmake configure...&quot;</span><br><span class="line">   ./configure &amp;&gt; /dev/null</span><br><span class="line">   if [ `echo $?` -eq 0 ]</span><br><span class="line">   then</span><br><span class="line">      echo &quot;cmake make &amp;&amp; make install...&quot;</span><br><span class="line">      make &amp;&amp; make install &amp;&gt; /dev/null</span><br><span class="line">      if [ `echo $?` -eq 0 ]</span><br><span class="line">      then</span><br><span class="line">         echo -e &quot;\e[1;32m cmake installed sucessfully \e[0m&quot;</span><br><span class="line">      else</span><br><span class="line">         echo -e &quot;\e[1;31m cmake installed failed \e[0m&quot;</span><br><span class="line">         exit 1</span><br><span class="line">      fi</span><br><span class="line">   else</span><br><span class="line">      echo -e &quot;\e[1;31m error:cmake configure failed \e[0m&quot;</span><br><span class="line">      exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">下载libzip1.1以上版本</span></span><br><span class="line">   cd /usr/local</span><br><span class="line">   if [ ! `wget --no-check-certificate https://libzip.org/download/libzip-$&#123;libzip_version&#125;.tar.gz &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       echo &quot;tar libzip...&quot;</span><br><span class="line">       tar -xf libzip-$&#123;libzip_version&#125;.tar.gz</span><br><span class="line">       if [ ! -d libzip-$&#123;libzip_version&#125; ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;31m error:not found libzip-$&#123;libzip_version&#125; \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       else</span><br><span class="line">           cd libzip-$&#123;libzip_version&#125;</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:Failed to download libzip-$&#123;libzip_version&#125;.tar.gz \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">安装libzip</span></span><br><span class="line">   mkdir build;cd build</span><br><span class="line">   echo &quot;cmake libzip...&quot;</span><br><span class="line">   cmake .. &amp;&gt; /dev/null</span><br><span class="line">   if [ `echo $?` -eq 0 ]</span><br><span class="line">   then</span><br><span class="line">       echo &quot;make &amp;&amp; make install libzip...&quot;</span><br><span class="line">       make &amp;&amp; make install &amp;&gt; /dev/null</span><br><span class="line">       if [ `echo $?` -eq 0 ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;32m libzip install sucessfully \e[0m&quot;</span><br><span class="line">           echo -e &#x27;/usr/local/lib64\n/usr/local/lib\n/usr/lib\n/usr/lib64&#x27;&gt;&gt; /etc/ld.so.conf</span><br><span class="line">           ldconfig -v &amp;&gt; /dev/null</span><br><span class="line">       else</span><br><span class="line">           echo -e &quot;\e[1;31m error:libzip install failed \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:lipzip cmake failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function php_install()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">下载php</span></span><br><span class="line">   cd /usr/local</span><br><span class="line">   if [ ! `wget https://www.php.net/distributions/php-$&#123;php_version&#125;.tar.bz2 &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       echo &quot;tar php...&quot;</span><br><span class="line">       tar -xf php-$&#123;php_version&#125;.tar.bz2</span><br><span class="line">       if [ ! -d php-$&#123;php_version&#125; ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;31m error:not found php-$&#123;php_version&#125; \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       else</span><br><span class="line">           cd php-$&#123;php_version&#125;</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:Failed to download php-$&#123;php_version&#125;.tar.bz2 \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">安装php</span></span><br><span class="line">   echo &quot;configure php...&quot;</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">要php以apache模块运行需加上--with-apxs2=/usr/localapache/bin/apxs参数</span></span><br><span class="line">   ./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/etc --with-mysqli=mysqlnd --enable-pdo --with-pdo-mysql=mysqlnd --with-iconv-dir=/usr/local/ --enable-fpm --with-fpm-user=www --with-fpm-group=www --with-pcre-regex --with-zlib --with-bz2 --enable-calendar --disable-phar --with-curl --enable-dba --with-libxml-dir --enable-ftp --with-gd --with-jpeg-dir --with-png-dir --with-zlib-dir --with-freetype-dir --enable-gd-jis-conv --with-mhash --enable-mbstring --enable-opcache=yes --enable-pcntl --enable-xml --disable-rpath --enable-shmop --enable-sockets --enable-zip --enable-bcmath --with-snmp --disable-ipv6 --with-gettext --disable-rpath --disable-debug --enable-embedded-mysqli --with-mysql-sock=/var/lib/mysql/ &amp;&gt; /dev/null</span><br><span class="line">   if [ `echo $?` -eq 0 ]</span><br><span class="line">   then</span><br><span class="line">       echo &quot;make &amp;&amp; make install php...&quot;</span><br><span class="line">       make &amp;&amp; make install &amp;&gt; /dev/null</span><br><span class="line">       if [ `echo $?` -eq 0 ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;32m php install sucessfully \e[0m&quot;</span><br><span class="line">       else</span><br><span class="line">           echo -e &quot;\e[1;31m php install failed \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m configure php failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function php_set()</span><br><span class="line">&#123;</span><br><span class="line">    if [ ! -f /usr/local/php-$&#123;php_version&#125;/sapi/fpm/php-fpm.service ]</span><br><span class="line">    then</span><br><span class="line">        echo -e &quot;\e[1;31m No found php-fpm.service \e[0m&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    else</span><br><span class="line">        cp /usr/local/php-$&#123;php_version&#125;/sapi/fpm/php-fpm.service /etc/systemd/system</span><br><span class="line">        if [ `echo $?` -ne 0 ]</span><br><span class="line">        then</span><br><span class="line">            echo -e &quot;\e[1;31m Copy php-fpm.service failed \e[0m&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        else</span><br><span class="line">            sed -i &#x27;/PrivateTmp=true/a\ProtectSystem=false&#x27; /etc/systemd/system/php-fpm.service</span><br><span class="line">            systemctl daemon-reload</span><br><span class="line">            echo -e &quot;\e[1;32m php set sucessfully \e[0m&quot;</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check</span><br><span class="line">pre</span><br><span class="line">php_install</span><br><span class="line">php_set</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置PHP</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/php/etc</span><br><span class="line">cp php-fpm.conf.default php-fpm.conf</span><br><span class="line">cp php-fpm.d/www.conf.default php-fpm.d/www.conf</span><br><span class="line"></span><br><span class="line">egrep -v &#x27;^;|^$&#x27; php-fpm.conf</span><br><span class="line">[global]</span><br><span class="line">pid = run/php-fpm.pid</span><br><span class="line">error_log = log/php-fpm.log</span><br><span class="line">daemonize = yes</span><br><span class="line">include=/usr/local/php/etc/php-fpm.d/*.conf</span><br><span class="line"></span><br><span class="line">egrep -v &#x27;^;|^$&#x27; php-fpm.d/www.conf</span><br><span class="line">[www]</span><br><span class="line">user = www</span><br><span class="line">group = www</span><br><span class="line">listen = 127.0.0.1:9000</span><br><span class="line">listen.owner = www</span><br><span class="line">listen.group = www</span><br><span class="line">listen.mode = 0660</span><br><span class="line">pm = dynamic</span><br><span class="line">pm.max_children = 5</span><br><span class="line">pm.start_servers = 2</span><br><span class="line">pm.min_spare_servers = 1</span><br><span class="line">pm.max_spare_servers = 3</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>启动</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start php-fpm</span><br></pre></td></tr></table></figure>

<h4 id="1-5-3-PHP作为Apache模块运行"><a href="#1-5-3-PHP作为Apache模块运行" class="headerlink" title="1.5.3 PHP作为Apache模块运行"></a>1.5.3 PHP作为Apache模块运行</h4><ol>
<li>在apache主配置文件中调用子配置文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/httpd.conf</span><br><span class="line">include conf/extra/php.conf</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置子配置文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/php.con</span><br><span class="line">LoadModule php7_module modules/libphp7.so</span><br><span class="line">AddType application/x-httpd-php .php</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置虚拟主机</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web&quot;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>写web目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;this is cqm web&#x27; &gt; /usr/local/apache/htdocs/web/index.html</span><br><span class="line">vim /usr/local/apache/htdocs/web/phpinfo.php</span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo()</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>测试</li>
</ol>
<p><img src="/2024/02/18/web/php%E4%BB%A5%E6%A8%A1%E5%9D%97%E8%BF%90%E8%A1%8C.png" alt="php以模块运行"></p>
<h4 id="1-5-4-PHP作为独立服务运行"><a href="#1-5-4-PHP作为独立服务运行" class="headerlink" title="1.5.4 PHP作为独立服务运行"></a>1.5.4 PHP作为独立服务运行</h4><p>PHP作为独立服务运行有两种模式：</p>
<ul>
<li>TCP socket模式</li>
<li>UNIX socket模式</li>
</ul>
<p><strong>TCP socket模式</strong></p>
<ol>
<li>修改<a href="http://www.conf文件/">www.conf文件</a></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/php/etc/php-fpm.d/www.conf</span><br><span class="line">listen = 127.0.0.1:9000</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web&quot;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/usr/local/apache/htdocs/web&quot;&gt;</span><br><span class="line">	Options Indexes FollowSymLinks</span><br><span class="line">	AllowOverride None</span><br><span class="line">	Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">	DirectoryIndex index.php index.html</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">&lt;FilesMatch \.php$&gt;</span><br><span class="line">	SetHandler &quot;proxy:fcgi://127.0.0.1:9000&quot;</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在apache主配文件添加关联</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/httpd.conf</span><br><span class="line">include conf/extra/php-fpm.conf</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>配置子配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/php-fpm.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">载入需要的模块</span></span><br><span class="line">LoadModule proxy_module modules/mod_proxy.so</span><br><span class="line">LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</span><br></pre></td></tr></table></figure>

<p><strong>UNIX socket模式</strong></p>
<ol>
<li>修改<a href="http://www.conf文件/">www.conf文件</a></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/php/etc/php-fpm.d/www.conf</span><br><span class="line">listen = /usr/local/php/etc/php-fpm.socket</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置虚拟主机</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch \.php$&gt;</span><br><span class="line">        SetHandler &quot;proxy:unix:/usr/local/php/etc/php-fpm.socket|fcgi://localhost/&quot;</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-6-Apache常用模块"><a href="#1-6-Apache常用模块" class="headerlink" title="1.6 Apache常用模块"></a>1.6 Apache常用模块</h3><h4 id="1-6-1-长连接"><a href="#1-6-1-长连接" class="headerlink" title="1.6.1 长连接"></a>1.6.1 长连接</h4><p>HTTP采用TCP进行传输，是面向连接的协议，每完成一次请求就要经历以下过程：</p>
<ul>
<li>三次握手</li>
<li>发起请求</li>
<li>响应请求</li>
<li>四次挥手</li>
</ul>
<p>那么N个请求就要建立N次连接，如果希望用户能够更快的拿到数据，服务器的压力降到最低，那么靠长连接就可以解决。</p>
<p>长连接实际上就是优化了TCP连接。</p>
<p>Apache默认开启了长连接，持续时间为5秒，在httpd-default.conf中可以定义。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-default.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启长连接</span></span><br><span class="line">KeepAlive On</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">限制每个连接允许的请求数</span></span><br><span class="line">MaxKeepAliveRequests 500</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">长连接时间</span></span><br><span class="line">KeepAliveTimeout 5</span><br></pre></td></tr></table></figure>

<h4 id="1-6-2-静态缓存"><a href="#1-6-2-静态缓存" class="headerlink" title="1.6.2 静态缓存"></a>1.6.2 静态缓存</h4><p>用户每次访问网站都会将页面中的所有元素都请求一遍，全部下载后通过浏览器渲染，展示到浏览器中。但是，网站中的某些元素我们一般都是固定不变的，比如logo、框架文件等。用户每次访问都需要加载这些元素。这样做好处是保证了数据的新鲜，可是这些数据不是常变化的，很久才变化一次。每次都请求、下载浪费了用户时间和公司带宽。</p>
<p>所以我们通过静态缓存的方式，将这些不常变化的数据缓存到用户本地磁盘，用户以后再访问这些请求，直接从本地磁盘打开加载，这样的好处是加载速度快，且节约公司带宽及成本。</p>
<ol>
<li>在apache主配文件中加载缓存模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/httpd.conf</span><br><span class="line">LoadModule expires_module modules/mod_expires.so</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改虚拟主机文件调用模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web&quot;</span><br><span class="line">    </span><br><span class="line">    &lt;IfMoudle expires_module&gt;</span><br><span class="line">    #开启缓存</span><br><span class="line">    ExpiresActive on</span><br><span class="line">    #针对不同类型元素设置缓存时间</span><br><span class="line">    ExpiresByType image/gif  &quot;access plus 1 days&quot;</span><br><span class="line">    ExpiresByType image/jpeg &quot;access plus 24 hours&quot;</span><br><span class="line">    ExpiresByType image/png &quot;access plus 24 hours&quot;</span><br><span class="line">    #now 相当于 access</span><br><span class="line">    ExpiresByType text/css &quot;now plus 2 hour&quot;</span><br><span class="line">    ExpiresByType application/x-javascript &quot;now plus 2 hours&quot;</span><br><span class="line">    ExpiresByType application/x-shockwave-flash &quot;now plus 2 hours”</span><br><span class="line">    #其他数据不缓存</span><br><span class="line">    ExpiresDefault &quot;now plus 0 min&quot;</span><br><span class="line">    &lt;/IfModule&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-6-3-数据压缩"><a href="#1-6-3-数据压缩" class="headerlink" title="1.6.3 数据压缩"></a>1.6.3 数据压缩</h4><p>数据从服务器传输到客户端，需要传输时间，文件越大传输时间就越长，为了减少传输时间，我们一般把数据压缩后在传给客户端。</p>
<p>apache支持两种模式的压缩：</p>
<ul>
<li>default</li>
<li>gzip</li>
</ul>
<p>两者的区别：</p>
<ul>
<li>mod_deflate 压缩速度快。</li>
<li>mod_gzip 的压缩比略高。</li>
<li>一般情况下，mod_gzip 会比 mod_deflate 多出 4%~6％ 的压缩量。</li>
<li>mod_gzip 对服务器CPU的占用要高一些，所以 mod_deflate 是专门为确保服务器的性能而使用的一个压缩模块，只需较少的资源来进行压缩。</li>
</ul>
<ol>
<li>在apache主配文件中加载压缩模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/httpd.conf</span><br><span class="line">LoadModule deflate_module modules/mod_deflate.so</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改虚拟主机文件调用模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web&quot;</span><br><span class="line">    </span><br><span class="line">    &lt;IfMoudle deflate_module&gt;</span><br><span class="line">    #压缩等级1-9，数字越大压缩能力越好，相应地也越耗CPU性能</span><br><span class="line">    DeflateCompressionLevel 4</span><br><span class="line">    #压缩类型，html、xml、php、css、js</span><br><span class="line">	AddOutputFilterByType DEFLATE text/html text/plain text/xml application/x-javascript application/x-httpd-php</span><br><span class="line">	AddOutputFilter DEFLATE js css</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">浏览器匹配为IE1-6的不压缩</span></span><br><span class="line">	BrowserMatch \bMSIE\s[1-6] dont-vary</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">设置不压缩的文件</span></span><br><span class="line">	SetEnvIfNoCase Request_URI .(?:gif|jpe?g|png)$ no-gzip dont-vary</span><br><span class="line">	SetEnvIfNoCase Request_URI .(?:exe|t?gz|zip|bz2|sit|rar)$ no-gzip dont-vary</span><br><span class="line">	SetEnvIfNoCase Request_URI .(?:pdf|doc)$ no-gzip dont-vary</span><br><span class="line">    &lt;/IfModule&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-6-4-限速"><a href="#1-6-4-限速" class="headerlink" title="1.6.4 限速"></a>1.6.4 限速</h4><p>网站除了能共享页面给用户外，还能作为下载服务器存在。但是作为下载服务器时，我们应该考虑服务器的带宽和IO的性能，防止部分邪恶分子会通过大量下载的方式来攻击你的带宽和服务器IO性能。</p>
<p>问题：</p>
<ul>
<li>假如你的服务器被邪恶分子通过下载的方式把带宽占满了，那么你或其他用户在访问的时候就会造成访问慢或者根本无法访问。</li>
<li>假如你的服务器被邪恶分子通过下载的方式把服务器IO占满了，那么你的服务器将会无法处理用户请求或宕机。</li>
</ul>
<p>以上问题可以通过限速来解决，apache自带了基于宽带限速的模块：</p>
<ul>
<li>ratelimit_module：只能对连接下载速度做限制，且是单线程的下载，迅雷等下载工具使用的是多线程下载。</li>
<li>mod_limitipconn：限制每 IP 的连接数，需要额外安装该模块。</li>
</ul>
<p><strong>ratelimit_module模块</strong></p>
<ol>
<li>在apache主配文件中加载压缩模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/httpd.conf</span><br><span class="line">LoadModule ratelimit_module modules/mod_ratelimit.so</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改虚拟主机文件调用模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web&quot;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Location相对路径：/usr/local/apache/htdocs/...</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Directory绝对路径：...</span></span><br><span class="line">&lt;Location /download&gt;</span><br><span class="line">	SetOutputFiler RATE_LIMIT</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">限速100k</span></span><br><span class="line">	SetEnv rate-limit 100</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>

<p><strong>mod_limitipconn模块</strong></p>
<ol>
<li>下载安装模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://dominia.org/djao/limit/mod_limitipconn-0.24.tar.bz2</span><br><span class="line">tar -xf mod_limitipconn-0.24.tar.bz2</span><br><span class="line">cd mod_limitipconn-0.24</span><br><span class="line">vim Makefile</span><br><span class="line">    apxs = &quot;/usr/local/apache/bin/apxs&quot;</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在apache主配文件启用模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/httpd.conf</span><br><span class="line">LoadModule limitipconn_module modules/mod_limitipconn.so</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改虚拟主机文件调用模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Location /download&gt;</span><br><span class="line">	SetOutputFiler RATE_LIMIT</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">限速100k</span></span><br><span class="line">	SetEnv rate-limit 100</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">限制线程数</span></span><br><span class="line">	MaxConnPerIP 3</span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">对index.html文件不作限制</span></span><br><span class="line">	NoIPLimit index.html</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-6-5-访问控制"><a href="#1-6-5-访问控制" class="headerlink" title="1.6.5 访问控制"></a>1.6.5 访问控制</h4><p>在生产环境中，网站分为公站和私站，公站允许所有人访问，但私站就只允许内部人员访问，Require就可以实现访问控制的功能。</p>
<p>容器：</p>
<ul>
<li>RequireAny：一个符合即可通过</li>
<li>RequireAll：所有符合才可通过</li>
<li>Requirenone：所有都不符合才可通过</li>
</ul>
<p><strong>普通的访问控制</strong></p>
<ol>
<li>修改虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web&quot;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/usr/local/apache/htdocs/web/test&quot;&gt;</span><br><span class="line">	AllowOverride None</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">拒绝所有人访问</span></span><br><span class="line">	Require all denied</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">允许该地址段的用户访问</span></span><br><span class="line">	Require ip 192.168.88</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">允许该主机访问</span></span><br><span class="line">	Require host www.cqm.com</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>

<p><strong>用户登录验证访问控制</strong></p>
<ol>
<li>修改虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web&quot;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/usr/local/apache/htdocs/web/test&quot;&gt;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">定义提示信息，用户访问时提示信息会出现在认证的对话框中</span></span><br><span class="line">	AuthName &quot;Private&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">定义认证类型，在HTTP1.0中，只有一种认证类型：basic。在HTTP1.1中有几种认证类型，如：MD5</span></span><br><span class="line">	AuthType Basic</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">定义包含用户名和密码的文本文件，每行一对</span></span><br><span class="line">	AuthUserFile &quot;/usr/local/apache/user.dbm&quot;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">配合容器使用，只有条件全部符合才能通过</span></span><br><span class="line">	&lt;RequireAll&gt;</span><br><span class="line">		Require not ip 192.168.88</span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">　require user user1 user2 (只有用户user1和user2可以访问)</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">　requires <span class="built_in">groups</span> group1 (只有group1中的成员可以访问)</span></span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">　require valid-user (在AuthUserFile指定的文件中的所有用户都可以访问)</span></span><br><span class="line">		Require valid-user</span><br><span class="line">	&lt;/RequireAll&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>生成用户文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成cqm用户</span></span><br><span class="line">/usr/local/apache/bin/htpasswd -cm /usr/local/apache/user.dbm cqm</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="1-6-6-URL重写"><a href="#1-6-6-URL重写" class="headerlink" title="1.6.6 URL重写"></a>1.6.6 URL重写</h4><p>Apache通过mod_rewrite模块可以实现URL重写的功能，URL重写其实就是改写用户浏览器中的URL地址。</p>
<ol>
<li>在主配文件开启模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/httpd.conf</span><br><span class="line">LoadModule rewrite_module modules/mod_rewrite.so</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web&quot;</span><br><span class="line">    # 开启URL重写功能</span><br><span class="line">    RewriteEngine on</span><br><span class="line">    # 重写规则，跳转到百度</span><br><span class="line">    RewriteRule &quot;^/$&quot; &quot;http://www.baidu.com&quot; [NC,L]</span><br><span class="line">    # 匹配条件，根据请求头进行匹配</span><br><span class="line">    RewriteCond &quot;%&#123;HTTP_USER_AGENT&#125;&quot; &quot;chrome&quot; [NC,OR]</span><br><span class="line">    RewriteCond &quot;%&#123;HTTP_USER_AGENT&#125;&quot; &quot;curl&quot;</span><br><span class="line">    # 重写规则，和匹配到的条件配合使用，请求头匹配到chrome或curl则返回403状态码</span><br><span class="line">    RewriteRule &quot;^/$&quot; - [F]</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">RewreteRule [flag] 部分标记规则</span><br><span class="line">R:强制外部重定向</span><br><span class="line">F:禁用URL，返回403HTTP状态码</span><br><span class="line">G:强制URL为GONE，返回410HTTP状态码</span><br><span class="line">P:强制使用代理转发</span><br><span class="line">L:表明当前规则是最后一条规则，停止分析以后规则的重写</span><br><span class="line">N:重新从第一条规则开始运行重写过程</span><br><span class="line">C:与下一条规则关联</span><br><span class="line">NS:只用于不是内部子请求</span><br><span class="line">NC:不区分大小写</span><br></pre></td></tr></table></figure>

<p><strong>通过URL重写实现分流功能</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/apache/conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/usr/local/apache/htdocs/web&quot;</span><br><span class="line">    RewriteEngine on</span><br><span class="line">    RewriteCond &quot;%&#123;HTTP_USER_AGENT&#125;&quot; &quot;(chrome|curl)&quot; [NC,OR]</span><br><span class="line">    RewriteRule &quot;^/$&quot; &quot;http://pc.cqm.com&quot; [NC]</span><br><span class="line">    RewriteCond &quot;%&#123;HTTP_USER_AGENT&#125;&quot; &quot;(iPhone|Blackberry|Android|ipad)&quot; [NC]</span><br><span class="line">    RewriteRule &quot;^/$&quot; &quot;http://phone.cqm.com&quot; [NC]</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-6-7-压力测试"><a href="#1-6-7-压力测试" class="headerlink" title="1.6.7 压力测试"></a>1.6.7 压力测试</h4><p>Apache压力测试使用ab命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ab</span><br><span class="line">-A:指定连接服务器的基本的认证凭据</span><br><span class="line">-c:指定一次向服务器发出请求数</span><br><span class="line">-C:添加cookie</span><br><span class="line">-g:将测试结果输出为“gnuolot”文件</span><br><span class="line">-h:显示帮助信息</span><br><span class="line">-H:为请求追加一个额外的头</span><br><span class="line">-i:使用“head”请求方式</span><br><span class="line">-k:激活HTTP中的“keepAlive”特性</span><br><span class="line">-n:指定测试会话使用的请求数</span><br><span class="line">-p:指定包含数据的文件</span><br><span class="line">-q:不显示进度百分比</span><br><span class="line">-T:使用POST数据时，设置内容类型头</span><br><span class="line">-v:设置详细模式等级</span><br><span class="line">-w:以HTML表格方式打印结果</span><br><span class="line">-x:以表格方式输出时，设置表格的属性</span><br><span class="line">-X:使用指定的代理服务器发送请求</span><br><span class="line">-y:以表格方式输出时，设置表格属性</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/apache/bin/ab -n 10000 -c 200 http:...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">并发数</span></span><br><span class="line">per second...</span><br></pre></td></tr></table></figure>



<h2 id="二、Nginx"><a href="#二、Nginx" class="headerlink" title="二、Nginx"></a>二、Nginx</h2><h3 id="2-1-Nginx介绍"><a href="#2-1-Nginx介绍" class="headerlink" title="2.1 Nginx介绍"></a>2.1 Nginx介绍</h3><p>Nginx是一款是由俄罗斯的程序设计师Igor Sysoev所开发高性能的 Web和 反向代理服务器，也是一个 IMAP&#x2F;POP3&#x2F;SMTP 代理服务器。和apache一样，都是web服务器软件，因为其性能优异，所以被广大运维喜欢。又因为nginx是一个轻量级的web服务器，相比apache来说资源消耗更低。</p>
<p>Nginx中文文档：<a href="https://www.nginx.cn/doc/index.html">https://www.nginx.cn/doc/index.html</a></p>
<h3 id="2-2-通过脚本源码安装Nginx"><a href="#2-2-通过脚本源码安装Nginx" class="headerlink" title="2.2 通过脚本源码安装Nginx"></a>2.2 通过脚本源码安装Nginx</h3><ol>
<li>编写安装脚本</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">vim nginx-install.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">nginx_version=1.21.3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检测</span></span><br><span class="line">function check()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">检测是否为root</span></span><br><span class="line">   if [ $USER != &quot;root&quot; ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;\e[1;31m error:need to be root so that \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">检测wget是否安装</span></span><br><span class="line">   if [ ! -e /usr/bin/wget ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;\e[1;31m error:not found command /usr/bin/wget \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装前准备</span></span><br><span class="line">function install_pre()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">安装依赖</span></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">0:stdin标准输入   1:stdout标准输出   2:stderr错误输出</span></span><br><span class="line">   if [ ! `yum -y install gcc-* pcre-devel zlib-devel &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;\e[1;31m error:yum install dependency package failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash">下载源码包</span></span><br><span class="line">   cd /usr/local/</span><br><span class="line">   if [ ! `wget http://nginx.org/download/nginx-$&#123;nginx_version&#125;.tar.gz &amp;&gt; /dev/null` ]</span><br><span class="line">   then</span><br><span class="line">       tar -xf nginx-$&#123;nginx_version&#125;.tar.gz</span><br><span class="line">       if [ ! -d nginx-$&#123;nginx_version&#125; ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;31m error:not found nginx-$&#123;nginx_version&#125; \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:wget file nginx-$&#123;nginx_version&#125;.tar.gz failed \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装</span></span><br><span class="line">function install_nginx()</span><br><span class="line">&#123;</span><br><span class="line">   cd /usr/local/nginx-$&#123;nginx_version&#125;</span><br><span class="line">   echo &quot;nginx configure...&quot;</span><br><span class="line">   ./configure --prefix=/usr/local/nginx &amp;&gt; /dev/null</span><br><span class="line">   if [ `echo $?` -eq 0 ]</span><br><span class="line">   then</span><br><span class="line">       echo &quot;nginx make...&quot;</span><br><span class="line">       make &amp;&amp; make install &amp;&gt; /dev/null</span><br><span class="line">       if [ `echo $?` -eq 0 ]</span><br><span class="line">       then</span><br><span class="line">           echo -e &quot;\e[1;32m nginx install success \e[0m&quot;</span><br><span class="line">       else</span><br><span class="line">           echo -e &quot;\e[1;31m error:nginx install fail \e[0m&quot;</span><br><span class="line">           exit 1</span><br><span class="line">       fi</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;\e[1;31m error:nginx configure fail \e[0m&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check</span><br><span class="line">install_pre</span><br><span class="line">install_nginx</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写启动脚本</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Source <span class="keyword">function</span> libiary</span></span><br><span class="line">if [ -f /etc/init.d/functions ]</span><br><span class="line">then</span><br><span class="line">    . /etc/init.d/functions</span><br><span class="line">else</span><br><span class="line">    echo &quot;Not found file /etc/init.d/functions&quot;</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">nginxd=/usr/local/nginx/sbin/nginx</span><br><span class="line">nginx_pid=/usr/local/nginx/logs/nginx.pid</span><br><span class="line"></span><br><span class="line">function nginx_start()</span><br><span class="line">&#123;</span><br><span class="line">   nginx_num=`ps -ef | grep nginx | wc -l`</span><br><span class="line">   if [ $nginx_num -gt 1 ] &amp;&amp; [ -f $nginx_pid ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;nginx [\e[1;32m running \e[0m]&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   elif [ $nginx_num -eq 1 ] &amp;&amp; [ -f $nginx_pid ]</span><br><span class="line">   then</span><br><span class="line">       killall nginx</span><br><span class="line">   fi</span><br><span class="line"><span class="meta prompt_">   $</span><span class="language-bash">nginxd</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function nginx_stop()</span><br><span class="line">&#123;</span><br><span class="line">   nginx_num=`ps -ef | grep nginx | wc -l`</span><br><span class="line">   if [ $nginx_num -eq 1 ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;nginx [\e[1;31m stopping \e[0m]&quot;</span><br><span class="line">       exit 1</span><br><span class="line">   elif [ $nginx_num -gt 1 ]</span><br><span class="line">   then</span><br><span class="line">       killall nginx</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function nginx_status()</span><br><span class="line">&#123;</span><br><span class="line">   nginx_num=`ps -ef | grep nginx | wc -l`</span><br><span class="line">   if [ $nginx_num -gt 1 ] &amp;&amp; [ -f $nginx_pid ]</span><br><span class="line">   then</span><br><span class="line">       echo -e &quot;nginx [\e[1;32m running \e[0m]&quot;</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;nginx [\e[1;31m stopping \e[0m]&quot;</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function nginx_restart()</span><br><span class="line">&#123;</span><br><span class="line">   nginx_stop</span><br><span class="line">   nginx_start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function nginx_reload()</span><br><span class="line">&#123;</span><br><span class="line">   nginx_num=`ps -ef | grep nginx | wc -l`</span><br><span class="line">   if [ $nginx_num -gt 1 ] &amp;&amp; [ -f $nginx_pid ]</span><br><span class="line">   then</span><br><span class="line">       $nginxd -s reload</span><br><span class="line">   else</span><br><span class="line">       echo -e &quot;nginx [\e[1;31m stopping \e[0m]&quot;</span><br><span class="line">   fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">start)</span><br><span class="line">        nginx_start</span><br><span class="line">        echo -e &quot;nginx start [\e[1;32m OK \e[0m]&quot;</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">        nginx_stop</span><br><span class="line">        echo -e &quot;nginx stop [\e[1;32m OK \e[0m]&quot;</span><br><span class="line">;;</span><br><span class="line">status)</span><br><span class="line">        nginx_status</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">        nginx_restart</span><br><span class="line">        echo -e &quot;nginx restart [\e[1;32m OK \e[0m]&quot;</span><br><span class="line">;;</span><br><span class="line">reload)</span><br><span class="line">        nginx_reload</span><br><span class="line">        echo -e &quot;nginx reload [\e[1;32m OK \e[0m]&quot;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<h3 id="2-3-Nginx的Server块"><a href="#2-3-Nginx的Server块" class="headerlink" title="2.3 Nginx的Server块"></a>2.3 Nginx的Server块</h3><p>当Nginx配置文件只有一个Server块时，那么该Server块就被Nginx认为是默认网站，所有发给Nginx的请求都会传给该Server块。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">监听80端口</span></span><br><span class="line">        listen       80;</span><br><span class="line">        # 域名</span><br><span class="line">        server_name  localhost;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">字符集</span></span><br><span class="line">        charset koi8-r;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">访问日志路径</span></span><br><span class="line">        access_log  logs/host.access.log  main;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">web根路径</span></span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">/代表相对路劲，这里代表/usr/local/nginx</span></span><br><span class="line">        location / &#123;</span><br><span class="line">        	# 根目录路径，这里代表/usr/local/nginx/html</span><br><span class="line">            root   html;</span><br><span class="line">            # 索引页</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta prompt_">		# </span><span class="language-bash">404状态码</span></span><br><span class="line">        error_page  404              /404.html;</span><br><span class="line">        location = /404.html&#123;</span><br><span class="line">        	root   html;</span><br><span class="line">        &#125;</span><br><span class="line">        # 50x状态码</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Nginx的访问控制"><a href="#2-4-Nginx的访问控制" class="headerlink" title="2.4 Nginx的访问控制"></a>2.4 Nginx的访问控制</h3><ol>
<li>编写主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    root   html;</span><br><span class="line">    index  index.html index.htm;</span><br><span class="line">    # 允许192.168.88.0/24的用户访问</span><br><span class="line">    allow 192.168.88.0/24;</span><br><span class="line">    # 拒绝所有</span><br><span class="line">    deny all;</span><br><span class="line">    # 基于客户端IP做过滤，符合条件的允许访问，不符合的返回404</span><br><span class="line">    # 这里为不是192.168.88的就返回404</span><br><span class="line">    if ( $remote_addr !~ &quot;192.168.88&quot; )&#123;</span><br><span class="line">        return 404;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-Nginx的用户验证"><a href="#2-5-Nginx的用户验证" class="headerlink" title="2.5 Nginx的用户验证"></a>2.5 Nginx的用户验证</h3><ol>
<li>编写主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">	root   html;</span><br><span class="line">	index  index.html index.htm;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">欢迎词</span></span><br><span class="line">	auth_basic &quot;welcome to cqm&#x27;s web&quot;;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">存放用户文件</span></span><br><span class="line">	auth_basic_user_file /usr/local/nginx/htpasswd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>生成用户文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/apache/bin/htpasswd -cm /usr/local/nginx/htpasswd cqm</span><br></pre></td></tr></table></figure>

<h3 id="2-6-Nginx参数"><a href="#2-6-Nginx参数" class="headerlink" title="2.6 Nginx参数"></a>2.6 Nginx参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx中的log_format可以用来自定义日志格式</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">log_format变量：</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">remote_addr:记录访问网站的客户端地址</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">remote_user:远程客户端用户名</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">time_local:记录访问时间与时区</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">request:用户的http请求起始行信息</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">status:http状态码，记录请求返回的状态码，例如：200、301、404等</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">body_bytes_sent:服务器发送给客户端的响应body字节数</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">http_referer:记录此次请求是从哪个连接访问过来的，可以根据该参数进行防盗链设置。</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">http_user_agent:记录客户端访问信息，例如：浏览器、手机客户端等</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">http_x_forwarded_for:当前端有代理服务器时，设置web节点记录客户端地址的配置，此参数生效的前提是代理服务器也要进行相关的x_forwarded_for设置</span></span><br></pre></td></tr></table></figure>

<h3 id="2-7-Nginx防盗链"><a href="#2-7-Nginx防盗链" class="headerlink" title="2.7 Nginx防盗链"></a>2.7 Nginx防盗链</h3><p>盗链用大白话讲就是抓取别人网站的资源，加以利用，以至于被抓取资源的网站消耗了带宽，而收益的是抓取资源的人。</p>
<p>而反盗链就可以防止别人抓取自身网站的资源。</p>
<ol>
<li>编写主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    # 除了www.cqm.com之外，都返回403</span><br><span class="line">    valid_referers none blocked www.cqm.com;</span><br><span class="line">    if ($invalid_referer)&#123;</span><br><span class="line">       return 403;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-8-Nginx虚拟主机"><a href="#2-8-Nginx虚拟主机" class="headerlink" title="2.8 Nginx虚拟主机"></a>2.8 Nginx虚拟主机</h3><p>Nginx的虚拟主机是通过server块来实现的。</p>
<h4 id="2-8-1-基于IP的虚拟主机"><a href="#2-8-1-基于IP的虚拟主机" class="headerlink" title="2.8.1 基于IP的虚拟主机"></a>2.8.1 基于IP的虚拟主机</h4><ol>
<li>修改主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line">include /usr/local/nginx/conf/conf.d/nginx_vhosts.conf;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/conf.d/nginx_vhosts.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 192.168.88.100;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html/web1;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 192.168.88.101;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html/web2;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>其它配置</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加一个逻辑网卡，重启即失效</span></span><br><span class="line">ifconfig eth0:1 192.168.88.100/24 up</span><br><span class="line">mkdir /usr/local/nginx/html/web&#123;1..2&#125;</span><br><span class="line">echo &#x27;this is web1&#x27; &gt; /usr/local/nginx/html/web1/index.html</span><br><span class="line">echo &#x27;this is web2&#x27; &gt; /usr/local/nginx/html/web2/index.html</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>测试</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl http://192.168.88.100/</span><br><span class="line">this is web1</span><br><span class="line">curl http://192.168.88.101/</span><br><span class="line">this is web2</span><br></pre></td></tr></table></figure>

<h4 id="2-8-2-基于端口的虚拟主机"><a href="#2-8-2-基于端口的虚拟主机" class="headerlink" title="2.8.2 基于端口的虚拟主机"></a>2.8.2 基于端口的虚拟主机</h4><ol>
<li>修改虚拟主机文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/conf.d/nginx_vhosts.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html/web1;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 81;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html/web2;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-8-3-基于域名的虚拟主机"><a href="#2-8-3-基于域名的虚拟主机" class="headerlink" title="2.8.3 基于域名的虚拟主机"></a>2.8.3 基于域名的虚拟主机</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/conf.d/nginx_vhosts.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.cqm1.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html/web1;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.cqm2.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html/web2;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-9-Nginx反向代理"><a href="#2-9-Nginx反向代理" class="headerlink" title="2.9 Nginx反向代理"></a>2.9 Nginx反向代理</h3><p>代理最常见的使用方式就是翻墙，能够实现让国内的用户访问国外的网站。</p>
<p>原理：</p>
<ul>
<li>用户讲请求发给代理服务器</li>
<li>代理服务器代替用户去获取数据</li>
<li>代理服务器将数据发送给用户</li>
</ul>
<p><strong>正常没有代理的上网</strong></p>
<p><img src="/2024/02/18/web/%E6%AD%A3%E5%B8%B8%E4%B8%8A%E7%BD%91%E6%B5%81%E7%A8%8B.png" alt="正常上网流程"></p>
<p><strong>使用代理服务器的上网</strong></p>
<p>&#x3D;<img src="/2024/02/18/web/%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%BD%91%E6%B5%81%E7%A8%8B.png" alt="使用代理服务器上网流程"></p>
<p>代理服务器又分为两种：正向代理、反向代理</p>
<p>正向代理：代理用户向服务器获取资源</p>
<p>反向代理：代理服务器去管理网络资源，用户有请求找反向代理就可以了</p>
<ol>
<li>编写反向代理服务器主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line">location / &#123;</span><br><span class="line">    index index.html index.htm index.php;</span><br><span class="line">    # 访问代理服务器就会跳转到http://192.168.88.100</span><br><span class="line">    proxy_pass http://192.168.88.100;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>反向代理其它配置</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header Host $host;</span><br><span class="line"></span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line"></span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">client_max_body_size 10m; #允许客户端请求的最大单文件字节数</span><br><span class="line"></span><br><span class="line">client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数，</span><br><span class="line"></span><br><span class="line">proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line"></span><br><span class="line">proxy_send_timeout 90; #后端服务器数据回传时间(代理发送超时)</span><br><span class="line"></span><br><span class="line">proxy_read_timeout 90; #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line"></span><br><span class="line">proxy_buffer_size 4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line"></span><br><span class="line">proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span><br><span class="line"></span><br><span class="line">proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line"></span><br><span class="line">proxy_temp_file_write_size 64k; #设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br></pre></td></tr></table></figure>

<h3 id="2-10-Nginx下载限速"><a href="#2-10-Nginx下载限速" class="headerlink" title="2.10 Nginx下载限速"></a>2.10 Nginx下载限速</h3><p>限速方法主要分为：</p>
<ul>
<li>下载速度限制</li>
<li>单位时间内请求数限制</li>
<li>基于客户端的并发数限制</li>
</ul>
<p>Nginx官方提供的限制IP连接和并发的模块有两个：</p>
<p>limit_req_zone：用来限制单位时间内的请求数，即速率限制，采用的漏桶算法</p>
<p>limit_req_conn：来限制同一时间连接数，即并发限制</p>
<p><strong>单位时间内请求数限制</strong></p>
<ol>
<li>修改主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在http快下调用模块</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$binary_remote_addr</span>:基于ip地址做限制</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zone:创建缓存域和缓存大小</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rate:设置访问频数</span></span><br><span class="line">limit_req_zone $binary_remote_addr zone=cqm:10m rate=1r/s;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">server块</span></span><br><span class="line">location /test &#123;</span><br><span class="line">	...</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">调用模块</span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">当请求数超过5次时，就拒绝访问，并返回503状态码</span></span><br><span class="line">	limit_req zone=cqm burst=5 nodelay;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>限制并发连接数</strong></p>
<ol>
<li>修改主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在http快下调用模块</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$binary_remote_addr</span>:基于ip地址做限制</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">zone:创建缓存域和缓存大小</span></span><br><span class="line">limit_req_conn $binary_remote_addr zone=cqm:10m;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">server块</span></span><br><span class="line">location /test &#123;</span><br><span class="line">	...</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">限制同一时间内下载数为1个</span></span><br><span class="line">	limit_conn cqm 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>限制下载速度</strong></p>
<ol>
<li>修改主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location /test &#123;</span><br><span class="line">	...</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">限制下载速度为1k</span></span><br><span class="line">	limit_rate 1k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-11-Nginx的URL重写"><a href="#2-11-Nginx的URL重写" class="headerlink" title="2.11 Nginx的URL重写"></a>2.11 Nginx的URL重写</h3><p>rewrite的主要功能是实现URL地址的重定向。Nginx的rewrite功能需要PCRE软件的支持，即通过perl兼容正则表达式语句进行规则匹配的。默认参数编译nginx就会支持rewrite的模块，但是也必须要PCRE的支持。</p>
<p>URL模板语块：</p>
<ul>
<li>set：设置变量</li>
<li>if：判断</li>
<li>return：返回值或URL</li>
<li>break：终止</li>
<li>rewrite：重定向URL</li>
</ul>
<p><strong>例一：根据不同域名跳转到主域名的不同目录下</strong></p>
<ol>
<li>创建测试目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/nginx/html/&#123;cn,jp,us&#125;</span><br><span class="line">echo &#x27;this is China&#x27; &gt; /usr/local/nginx/html/cn/index.html</span><br><span class="line">echo &#x27;this is Japan&#x27; &gt; /usr/local/nginx/html/jp/index.html</span><br><span class="line">echo &#x27;this is America&#x27; &gt; /usr/local/nginx/html/us/index.html</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改hosts文件，以便解析</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.88.100 www.cqm.com</span><br><span class="line">192.168.88.100 www.cqm.com.cn</span><br><span class="line">192.168.88.100 www.cqm.com.jp</span><br><span class="line">192.168.88.100 www.cqm.com.us</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include /usr/local/nginx/conf/conf.d/rewrite.conf</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>修改重定向文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/conf.d/rewrite.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置重定向server</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.cqm.com.cn www.cqm.com.jp www.cqm.com.us;</span><br><span class="line">    location / &#123;</span><br><span class="line">        # 模糊匹配到cn的话，就跳转到http://www.cqm.com/cn下</span><br><span class="line">        if ($http_host ~ (cn)$)&#123;</span><br><span class="line">            set $nation cn;</span><br><span class="line">            rewrite ^/$ http://www.cqm.com/$nation;</span><br><span class="line">        &#125;</span><br><span class="line">        if ($http_host ~ (jp)$)&#123;</span><br><span class="line">            set $nation jp;</span><br><span class="line">            rewrite ^/$ http://www.cqm.com/$nation;</span><br><span class="line">        &#125;</span><br><span class="line">        if ($http_host ~ (us)$)&#123;</span><br><span class="line">            set $nation us;</span><br><span class="line">            rewrite ^/$ http://www.cqm.com/$nation;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.cqm.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html;</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>测试</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -L http://www.cqm.com.cn</span><br><span class="line">this is China</span><br><span class="line">curl -L http://www.cqm.com.jp</span><br><span class="line">this is Japan</span><br><span class="line">curl -L http://www.cqm.com.us</span><br><span class="line">this is America</span><br><span class="line">-L:自动获取重定向</span><br></pre></td></tr></table></figure>

<p><strong>例二：retuen以及break的简单实用</strong></p>
<ol>
<li>修改重定向文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/conf.d/rewrite.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.cqm.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html;</span><br><span class="line">        index index.html;</span><br><span class="line">        # 模糊匹配 ~</span><br><span class="line">        # 精确匹配 =</span><br><span class="line">        # 不匹配 !~</span><br><span class="line">        # 如果匹配请求头不是chrome的话，就返回403</span><br><span class="line">        if ($http_user_agent !~ &#x27;chrome&#x27;)&#123;</span><br><span class="line">            return 403;</span><br><span class="line">            # break放在return上面的话就不会执行return操作</span><br><span class="line">            # break;</span><br><span class="line">            # return http://www.baidu.com;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>flag</strong></p>
<p>flag是放在rewrite重定向的URL后边的，格式为：rewrite URL flag</p>
<p>flag的选项有：</p>
<ol>
<li>last：本条规则匹配完成后继续执行到最后。</li>
<li>break：本条规则匹配完成即终止。</li>
<li>redirect：返回302临时重定向。</li>
<li>permanent：返回301永久重定向。</li>
</ol>
<p>redirect和permanent的区别：设置permanent的话，新网址就会完全继承旧网址，旧网址的排名等完全清零，如果不是暂时迁移的情况下都建议使用permanent；设置redirect的话，新网址对旧网址没有影响，且新网址也不会有排名。</p>
<h3 id="2-12-Nginx优化"><a href="#2-12-Nginx优化" class="headerlink" title="2.12 Nginx优化"></a>2.12 Nginx优化</h3><h4 id="2-12-1-大并发"><a href="#2-12-1-大并发" class="headerlink" title="2.12.1 大并发"></a>2.12.1 大并发</h4><p>Nginx的工作模式：主进程 + 工作进程</p>
<p>假如Nginx服务器有4个CPU</p>
<ol>
<li>设置主配文件来实现高并发</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line">worker_processes  4;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定运行的核的编号，采用掩码的方式设置编号</span></span><br><span class="line">worker_cpu_affinity 0001 0010 0100 1000;</span><br><span class="line">events &#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">单个工作进程维护的请求队列长度，根据实际情况调整</span></span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-12-2-长连接"><a href="#2-12-2-长连接" class="headerlink" title="2.12.2 长连接"></a>2.12.2 长连接</h4><ol>
<li>修改主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">keepalive_timeout用来设置长连接，0代表关闭</span></span><br><span class="line">keepalive_timeout  0;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置长连接时间100s</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keepalive_timeout  100;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置每秒可以接受的请求数</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keepalive_requests 8192;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-12-3-压缩"><a href="#2-12-3-压缩" class="headerlink" title="2.12.3 压缩"></a>2.12.3 压缩</h4><p>Nginx是采用gzip进行压缩。</p>
<ol>
<li>修改主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启缓存</span></span><br><span class="line">gzip on;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Nginx做为反向代理的时候启用</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">off:关闭所有的代理结果数据压缩</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">expired:如果header中包含”Expires”头信息，启用压缩</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no-cache:如果header中包含”Cache-Control:no-cache”头信息，启用压缩</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no-store:如果header中包含”Cache-Control:no-store”头信息，启用压缩</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">private:如果header中包含”Cache-Control:private”头信息，启用压缩</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no_last_modified:启用压缩，如果header中包含”Last_Modified”头信息，启用压缩</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no_etag:启用压缩，如果header中包含“ETag”头信息，启用压缩</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">auth:启用压缩，如果header中包含“Authorization”头信息，启用压缩</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">any:无条件压缩所有结果数据</span></span><br><span class="line">gzip_proxied any;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用gzip压缩的最小文件，小于设置值的文件将不会压缩</span></span><br><span class="line">gzip_min_length 1k;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置压缩所需要的缓冲区大小</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">32 4K表示按照内存页（one memory page）大小以4K为单位（即一个系统中内存页为4K），申请32倍的内存空间</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">建议此项不设置，使用默认值</span></span><br><span class="line">gzip_buffers 32 4k;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置gzip压缩级别，级别越底压缩速度越快文件压缩比越小，反之速度越慢文件压缩比越大</span></span><br><span class="line">gzip_comp_level 1;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用于识别http协议的版本，早期的浏览器不支持gzip压缩，用户会看到乱码，所以为了支持前期版本加了此选项。默认在http/1.0的协议下不开启gzip压缩</span></span><br><span class="line">gzip_http_version 1.1;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置需要压缩的MIME类型,如果不在设置类型范围内的请求不进行压缩</span></span><br><span class="line">gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png application/vnd.ms-fontobject font/ttf font/opentype font/x-woff image/svg+xml;</span><br></pre></td></tr></table></figure>

<h4 id="2-12-4-静态缓存"><a href="#2-12-4-静态缓存" class="headerlink" title="2.12.4 静态缓存"></a>2.12.4 静态缓存</h4><p>将部分数据缓存在用户本地磁盘，用户加载时，如果本地和服务器的数据一致，则从本地加载。提升用户访问速度，提升体验度。节省公司带宽成本。</p>
<ol>
<li>修改主配文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">模糊匹配以png或gif结尾的文件</span></span><br><span class="line">location ~*  \.(png|gif)$ &#123;</span><br><span class="line">    # 缓存时间为1小时</span><br><span class="line">    expires 1h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="三、Tomcat"><a href="#三、Tomcat" class="headerlink" title="三、Tomcat"></a>三、Tomcat</h2><h3 id="3-1-Tomcat介绍"><a href="#3-1-Tomcat介绍" class="headerlink" title="3.1 Tomcat介绍"></a>3.1 Tomcat介绍</h3><p>Tomcat 服务器是一个免费的开放源代码的 Web 应用服务器，属于轻量级应用服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试 JSP 程序的首选。</p>
<p>实际上 Tomcat 是 Apache 服务器的扩展，但运行时它是独立运行的，所以当你运行 tomcat 时，它实际上作为一个与 Apache 独立的进程单独运行的。</p>
<p>Tomcat 官方文档：<a href="https://tomcat.apache.org/">https://tomcat.apache.org/</a></p>
<h3 id="3-2-Tomcat安装"><a href="#3-2-Tomcat安装" class="headerlink" title="3.2 Tomcat安装"></a>3.2 Tomcat安装</h3><ol>
<li>安装jdk和tomcat</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum -y install java-1.8.0-openjdk*</span><br><span class="line">wget https://downloads.apache.org/tomcat/tomcat-9/v9.0.43/bin/apache-tomcat-9.0.43.tar.gz</span><br><span class="line">tar -xf apache-tomcat-9.0.43.tar.gz</span><br><span class="line">mkdir /root/tomcat</span><br><span class="line">mv apache-tomcat-9.0.43.tar.gz/* /root/tomcat</span><br><span class="line">./root/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>Web</p><p><a href="https://warnerchen.github.io/2024/02/18/web/">https://warnerchen.github.io/2024/02/18/web/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Warner Chen</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-02-18</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-02-27</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/web/">web</a></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>Afdian.net</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/02/18/kubernetes/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Kubernetes</span></a></div></nav><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/NUX_Octodex.gif" alt="Warner Chen"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Warner Chen</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shenzhen, Guangdong, CN</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives/"><p class="title">67</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories/"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags/"><p class="title">25</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/warnerchen/" target="_blank" rel="me noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/warnerchen/"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.zerchin.xyz/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Zeqin</span></span><span class="level-right"><span class="level-item tag">www.zerchin.xyz</span></span></a></li><li><a class="level is-mobile" href="https://hackmd.io/@7vxmAdNPTmmlYGSRMuvbmw" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Andy</span></span><span class="level-right"><span class="level-item tag">hackmd.io</span></span></a></li><li><a class="level is-mobile" href="https://www.xtplayer.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Xiaolu</span></span><span class="level-right"><span class="level-item tag">www.xtplayer.cn</span></span></a></li><li><a class="level is-mobile" href="https://kingsd.top/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hailong</span></span><span class="level-right"><span class="level-item tag">kingsd.top</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-22T01:56:29.000Z">2025-04-22</time></p><p class="title"><a href="/2025/04/22/MetalLB-%E4%BD%BF%E7%94%A8%E9%9A%8F%E8%AE%B0/">MetalLB 使用随记</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-15T03:20:01.000Z">2025-04-15</time></p><p class="title"><a href="/2025/04/15/RKE2-%E4%BD%BF%E7%94%A8-Custom-CA-%E9%83%A8%E7%BD%B2/">RKE2 使用 Custom CA 部署</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-04-10T04:39:56.000Z">2025-04-10</time></p><p class="title"><a href="/2025/04/10/%E9%80%9A%E8%BF%87-Nginx-%E5%AE%9E%E7%8E%B0-RKE2-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/">通过 Nginx 实现 RKE2 高可用部署</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-25T07:03:27.000Z">2025-03-25</time></p><p class="title"><a href="/2025/03/25/Harvester-VM-OOM-%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">Harvester VM OOM 问题排查</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-03-18T06:27:29.000Z">2025-03-18</time></p><p class="title"><a href="/2025/03/18/Kubernetes-MCP-Server-%E4%BD%BF%E7%94%A8%E9%9A%8F%E8%AE%B0/">Kubernetes MCP Server 使用随记</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/04/"><span class="level-start"><span class="level-item">April 2025</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/03/"><span class="level-start"><span class="level-item">March 2025</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/02/"><span class="level-start"><span class="level-item">February 2025</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">January 2025</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">December 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/11/"><span class="level-start"><span class="level-item">November 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">October 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">September 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">August 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">June 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">March 2024</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">February 2024</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Kubernetes/"><span class="tag">Kubernetes</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ai/"><span class="tag">ai</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ansible/"><span class="tag">ansible</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/calico/"><span class="tag">calico</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cisco/"><span class="tag">cisco</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/container/"><span class="tag">container</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/containerd/"><span class="tag">containerd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/elasticsearch/"><span class="tag">elasticsearch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/elk/"><span class="tag">elk</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/etcd/"><span class="tag">etcd</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/istio/"><span class="tag">istio</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jenkins/"><span class="tag">jenkins</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/k8s/"><span class="tag">k8s</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kafka/"><span class="tag">kafka</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nexus/"><span class="tag">nexus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/prometheus/"><span class="tag">prometheus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/suse/"><span class="tag">suse</span><span class="tag">25</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zookeeper/"><span class="tag">zookeeper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tag">面试</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%A6%96%E9%A1%B5/"><span class="tag">首页</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/logo.jpg" alt="Warner&#039;s Wiki" height="28"></a><p class="is-size-7"><span>&copy; 2025 Warner Chen</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/warnerchen/"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>